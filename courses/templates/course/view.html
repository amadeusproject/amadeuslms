{% extends 'course/index.html' %}

{% load static i18n permission_tags custom_filters %}
{% load django_bootstrap_breadcrumbs %}

{% block style %}
<link rel="stylesheet" href="{% static 'css/course/course.css' %}">
{% endblock style %}

{% block javascript %}
  <script type="text/javascript" src="{% static 'js/course.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/modal_subject.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/topic_editation_presentation.js' %}"></script>
{% endblock %}

{% block breadcrumbs %}

{{ block.super }}
{% breadcrumb course 'course:view' course.slug %}

{% endblock %}

{% block content %}
{% if messages %}
{% for message in messages %}
<script type="text/javascript">
alertify.success('{{message}}');
</script>
{% endfor %}
{% endif %}

<div class="col-md-12 cards-content">
  <div class="group course-card ">
    <div class="panel panel-info">
      <div class="panel-heading course">
        <div class="row">
          <div class="col-xs-6 col-md-6 titleTopic">
            <h4>{{course.name}}</h4>
          </div>
          {% if user|has_role:'professor' or user|has_role:'system_admin' %}
          <div class="col-xs-6 col-md-6 divMoreActions" >
            <div class="btn-group">
              <button class="btn btn-default btn-sm dropdown-toggle" type="button" id="moreActions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fa fa-ellipsis-v fa-2x" aria-hidden="true"></i>
              </button>
              <ul class="dropdown-menu pull-right" aria-labelledby="moreActions">
                <li><a href="{% url 'course:replicate_course' course.slug %}"><i class="fa fa-files-o fa-fw" aria-hidden="true"></i>{% trans 'Replicate' %}</a></li>
                <li><a href="{% url 'course:update' course.slug %}"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i>{% trans 'Edit' %}</a></li>
                <li><a href="javascript:delete_course.get('{% url 'course:delete' course.slug %}','#course','#modal_course')"><i class="fa fa-trash fa-fw" aria-hidden="true"></i>&nbsp;{% trans 'Remove' %}</a></li>
              </ul>
            </div>
          </div>
          {% elif user|has_role:'student' %}
          {% if not request.user in course.students.all %}
          <a onclick="subscribe($(this), '{% url 'course:subscribe' course.slug %}', {{ course.id}}, '{% trans 'Are you sure you want to subscribe to this course?' %}')"><button class="btn btn-sm btn-primary btn-raised pull-right">{% trans 'Subscribe' %}</button></a>
          {% endif %}
          {% endif %}
        </div>
      </div>
      <div class="panel-body">
        <p><b>{% trans 'Coordinator' %}: </b>{{course.coordenator}}</p>
      </div>
    </div>
  </div>
  <div class="cards-detail">
    {% for subject in subjects %}
      <div class="panel panel-default panel_{{ subject.id }}">
        <div class="panel-heading heading_{{subject.id}} subject ui-sortable-handle">
          <div class="row">
            <div class="col-xs-9 col-md-6 titleTopic">
              <a role="button" href="{% url 'course:view_subject' subject.slug %}">
                <h4>{{subject.name}}</h4>
              </a>
            </div>
            {% if user|has_role:'professor' or user|has_role:'system_admin' %}
              <div class="col-xs-3 col-md-6 divMoreActions">
                <div class="btn-group">
                  <button class="btn btn-default btn-sm dropdown-toggle" type="button" id="moreActions" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-ellipsis-v fa-2x" aria-hidden="true"></i>
                  </button>
                  <ul class="dropdown-menu pull-right" aria-labelledby="moreActions">
                    <li><a href="{% url 'course:replicate_subject' subject.slug %}"><i class="fa fa-files-o fa-fw" aria-hidden="true"></i>&nbsp; {% trans "Replicate" %}</a></li>
                    <li><a href="{% url 'course:update_subject' subject.slug %}"> <i class="fa fa-pencil fa-fw" aria-hidden="true"></i>&nbsp; {% trans "Edit" %}</a></li>
                    <li><a href="{% url 'course:delete_subject' subject.slug %}" ><i class="fa fa-trash fa-fw" aria-hidden="true"></i>&nbsp; {% trans "Remove" %}</a></li>
                  </ul>
                </div>
              </div>
            {% endif %}

            {% if user|show_subject_subscribe:subject %}
              <div class="col-xs-3 col-md-2">
                <a onclick="subscribe($(this), '{% url 'course:subscribe_subject' subject.slug %}', {{ subject.id }}, '{% trans 'Are you sure you want to subscribe to this subject?' %}')" class="btn btn-sm btn-primary btn-raised">{% trans 'Subscribe' %}</a>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
    {% if  user|has_role:'professor' and user in course.professors.all or user|has_role:'system_admin' %}
      <div class="form-group">
        <a href="{% url 'course:create_subject' course.slug %}" class="btn btn-primary btn-lg btn-block btn-raised">{% trans 'Create Subject' %}<div class="ripple-container"></div></a>
      </div>
    {% endif %}
  </div>
</div>
<div id="modal_course">

</div>

{% endblock %}
